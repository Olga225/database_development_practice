Постановка задачи:

Дана таблица, содержащая информацию о структуре некоторого иерархического дерева. Создать запрос для определения всех путей от всех начальных вершин до всех конечных вершин по направленному дереву (от родительской вершины к дочерней). В пределах одного пути необходимо перемножить значения поля Количество и просуммировать результаты по всем путям от начальной вершины до конечной вершины

Объяснение алгоритма работы кода:

При решении данной задачи я поставила перед собой следующие подзадачи:
1.	Найти все маршруты от всех начальных вершин до всех конечных вершин (исходя из приведённого примера рассматриваются не только корни, т.е. вершины, не имеющие родителя, и листы, т.е. вершины, не имеющие потомка). 
2.	Для каждого маршрута определить всю последовательность значений вершин, через которые он проходит
3.	Найти произведение значений для каждого маршрута
4.	Выделить в маршрутах начальные и конечные вершины и посчитать количество маршрутов, у которых они соответственно совпадают
5.	Посчитать сумму произведений значений для всех групп маршрутов с одинаковой парой «начальная-конечная вершины»
6.	Вывести итоговый результат в необходимом формате
Для решения 1 задачи был использован иерархический подзапрос с обходом сверху вниз (от родителя к потомку). Соединение шло по соответствию номера дочерней вершины родителя номеру родительской вершины потомка. При этом к маршруту конкатенировался номер родительской вершины для полноты маршрута. Одновременно это и решало задачу 2, так как при обходе также проходило составление строк значений проходимых вершин.
Для решения задачи 3 было использована два подзапроса. Первый разбивал строку значений маршруту на множество строк, ориентируясь на разделительный символ. То, что одинаковые значения не будут удалены как повторяющиеся, обеспечивалось запоминанием также их уровня в иерархии. Второй подзапрос проводил группировку строк отдельных значений, относящихся к одному маршруту, и считал их произведение. Для этого использовалось свойства логарифмов (логарифм произведения равен сумме логарифмов множителей).
Задача 4 решалась с помощью регулярных выражений, находящих первую и последнюю вершины в маршруте.
Задача 5 реализовывалась на основе решения задачи 4 с помощью группировки по начальной и конечной вершинам.
Задача 6 решалась с помощью обращения к описанным выше подзапросам в основном запросе.
